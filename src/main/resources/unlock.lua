-- Redis分布式锁释放脚本
-- 功能：原子性地比较锁标识并释放锁，防止误删其他线程的锁
-- 
-- 参数说明：
-- KEYS[1]: 锁的key（格式：lock:业务名称）
-- ARGV[1]: 当前线程的唯一标识（格式：UUID-线程ID）
--
-- 返回值：
-- 1: 成功释放锁（删除了1个key）
-- 0: 释放失败（锁不存在或不属于当前线程）

-- 获取锁中存储的线程标识，并与当前线程标识进行比较
if(redis.call('get', KEYS[1]) == ARGV[1]) then
    -- 标识一致，说明锁属于当前线程，可以安全删除
    -- del命令返回删除的key数量（这里应该是1）
    return redis.call('del', KEYS[1])
end

-- 标识不一致或锁不存在，不能删除锁，返回0表示操作失败
return 0